# 2D Ecosystem Evolution Simulator

This project is a 2D agent-based ecosystem simulation designed to observe and analyze emergent evolutionary dynamics. It features animal agents with genetically determined traits that live, reproduce, and adapt within a procedurally generated world. The simulation core is built in Rust for performance, integrated with the Godot Engine (version X.Y) for visualization and user interaction via GDExtension.

## Features

* **Procedurally Generated Worlds:** Each simulation run can take place in a unique environment based on temperature and moisture maps generated using procedural noise.
* **Genetic Evolution:** Animals possess genes (size, speed, food preference, stealth, detection, mating rate) that are inherited with crossover and mutation, driving adaptation.
* **Agent-Based Modeling:** Animals make decisions based on internal needs (hunger, thirst, reproduction) and local environmental conditions.
* **Vore Types:** Animals are classified as Herbivores, Omnivores, or Carnivores based on their `food_preference` gene, influencing their diet and interactions.
* **Resource Dynamics:** Tiles contain resources like plant matter, water, and meat (from deceased animals) that are consumed and replenished.
* **Scent Trails:** Animals leave scent trails, influencing hunting and mating behaviors.
* **Performance-Oriented Backend:** Core simulation logic is implemented in Rust for efficiency, integrated with Godot via GDExtension.
* **Data Logging:** Simulation data (animal states, genes, timestamps) is logged to CSV files for external analysis and visualization.
* **Configurable Parameters:** Users can set various simulation parameters (map size, genetic rules, environmental factors) via the Godot UI or a CSV file.
* **Visualization:** Godot provides real-time visualization of biomes, animal counts on tiles, and aggregate population statistics. Python scripts are provided for generating detailed plots from logged data.

## Prerequisites

* **Godot Engine:** Version X.Y (or compatible) with .NET/C# support enabled if you intend to modify or re-export the Godot project with C# (though the core GDExtension is Rust). %TODO: Specify your Godot version. If not using C#, remove that part.
* **Rust Toolchain:** Required to compile the Rust simulation core. Visit [https://www.rust-lang.org/tools/install](https://www.rust-lang.org/tools/install).
* **(For Visualization)** Python 3.x with the following packages:
    * `pandas`
    * `matplotlib`
    * `seaborn`
    * `numpy`
    Install them using pip:
    ```bash
    pip install pandas matplotlib seaborn numpy
    ```

## Project Structure

The project is primarily divided into two main folders:

* `Simulation/`: Contains the Godot project files.
    * `SCRIPTS/`: GDScript files for UI, map generation, Godot-side simulation control, data logging.
    * `SCENES/`: Godot scene files (.tscn, .tres).
    * `ASSETS/` or `SPRITES/`: Visual assets like tilesets, sprites. %TODO: Adjust to your actual asset folder name
    * `Visualization/`: Python scripts for visualizing logged data.
    * `*.godot`: Godot project file.
    * `export_presets.cfg` (and potentially export templates if you distribute builds)
* `rust/`: Contains the Rust simulation core.
    * `simulation_core/` (or your crate name, e.g., `simulation/` as per your example)
        * `src/`: Rust source files (`lib.rs`, `animal.rs`, `map.rs`, etc.).
        * `Cargo.toml`: Rust project manifest.
        * `simulation_core.gdextension`: GDExtension definition file.
    * `target/`: (Generated by Rust) Contains compiled libraries. The relevant dynamic library (e.g., `simulation_core.dll` on Windows, `libsimulation_core.so` on Linux, `libsimulation_core.dylib` on macOS) needs to be placed in the Godot project directory.

A more detailed layout is available in `FILE_STRUCTURE.md`.

## Setup and Compilation

### 1. Rust Backend

1.  Navigate to the Rust project directory:
    ```bash
    cd rust/simulation_core 
    # Or your actual Rust crate directory, e.g., cd rust/simulation
    ```
2.  Build the Rust library:
    ```bash
    cargo build --release 
    # Use --release for optimized performance
    ```
3.  **Copy the compiled library:**
    * After a successful build, the dynamic library will be located in `rust/simulation_core/target/release/`.
    * It will be named something like:
        * Windows: `simulation_core.dll`
        * Linux: `libsimulation_core.so`
        * macOS: `libsimulation_core.dylib`
        (The name `simulation_core` depends on what you named your crate in `Cargo.toml` - it's `rust_project` in some previous outputs, but `Simulation_Core` was also used as a descriptive name. Ensure this matches your actual crate name from `Cargo.toml`.)
    * Copy this compiled library (e.g., `simulation_core.dll`) into the root of your Godot project directory (the `Simulation/` folder, alongside the `project.godot` file).
4.  **Ensure GDExtension File is Present:**
    * The `simulation_core.gdextension` file (or `[your_crate_name].gdextension`) must also be in the root of your Godot project directory. This file tells Godot how to load your Rust library. Its content should correctly point to the compiled library name.

### 2. Godot Project

1.  Open the Godot Engine.
2.  Click "Import" and navigate to the `Simulation/` folder containing the `project.godot` file, or "Scan" if it's already in your project list.
3.  Open the project.

## Running the Simulation

1.  Once the Godot project is open and the Rust library is compiled and copied correctly, you can run the main scene (e.g., `World.tscn` or your main simulation scene).
2.  Use the in-game UI to:
    * Load or set simulation parameters.
    * Generate the world map.
    * Spawn initial animals.
    * Start, pause, or step through the simulation.
    * Observe statistics and visualizations.
3.  Simulation data will be logged to CSV files in the Godot user data directory (typically `C:\Users\[YourUser]\AppData\Roaming\Godot\app_userdata\[YourProjectName]\` on Windows).

## Visualizing Logged Data

1.  After a simulation run, a CSV file (e.g., `simulation_data-TIMESTAMP.csv`) will be created.
2.  Navigate to the `Simulation/Visualization/` directory in your terminal.
3.  Run the Python script, providing the simulation ID (timestamp from the CSV filename) as a command-line argument:
    ```bash
    python visualizer.py [simulation_id_timestamp]
    # Example: python visualizer.py 1747063355
    ```
4.  Generated plots will be saved in a subdirectory (e.g., `PLOTS/simulation_plots_run_[simulation_id_timestamp]/`).

## Troubleshooting

* **Rust compilation errors:** Ensure your Rust toolchain is up to date and all dependencies in `Cargo.toml` are correct.
* **Godot "GDExtension library not found" errors:**
    * Double-check that the compiled Rust library (`.dll`, `.so`, `.dylib`) is in the correct location (root of the Godot project).
    * Verify that the `.gdextension` file is also in the root and correctly references the library name and paths for your operating system.
* **Python script errors:**
    * Ensure all required Python packages are installed.
    * Verify the path to the CSV data file is correct (especially the `godot_user_data_path` and your Godot project name part).
    * Check that the CSV file format matches what the script expects (column names, delimiter).
